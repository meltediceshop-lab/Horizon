{% comment %}
  MEGA MENÚ DINÁMICO JGT - Con Control de Grosor Ajustable
{% endcomment %}

{%- style -%}
  .jgt-nav-mega-{{ section.id }} {
    background-color: {{ section.settings.bg_color }};
    border-bottom: 1px solid #e0e0e0;
    position: sticky;
    top: 0;
    z-index: 99;
    font-family: 'Nunito', sans-serif;
  }

  .jgt-nav-link-{{ section.id }} {
    /* Control de grosor mediante padding vertical */
    padding-top: {{ section.settings.padding_vertical }}px;
    padding-bottom: {{ section.settings.padding_vertical }}px;
    padding-left: 12px;
    padding-right: 12px;
    display: flex;
    align-items: center;
    text-decoration: none;
    color: #002266;
    font-size: 13px;
    font-weight: 800;
    text-transform: uppercase;
    gap: 5px;
    position: relative;
    transition: color 0.2s;
  }

  .jgt-nav-link-{{ section.id }}:hover {
    color: #e30613;
  }

  .jgt-nav-link-{{ section.id }}.is-red {
    color: #e30613;
  }
{%- endstyle -%}

<nav class="jgt-nav-mega-{{ section.id }}">
  <div class="jgt-nav-container" style="max-width: 1440px; margin: 0 auto; padding: 0 20px;">
    <ul class="jgt-nav-list" style="display: flex; list-style: none; margin: 0; padding: 0; align-items: center; justify-content: center; flex-wrap: wrap;">
      {% for block in section.blocks %}
        <li class="jgt-nav-item" style="position: {% if block.type == 'mega_menu' %}static{% else %}relative{% endif %};" {{ block.shopify_attributes }}>
          
          <a href="{{ block.settings.link | default: '#' }}" class="jgt-nav-link-{{ section.id }} {% if block.settings.highlight %}is-red{% endif %}">
            {% if block.settings.icon_img != blank %}
              <img src="{{ block.settings.icon_img | image_url: width: 40 }}" alt="" style="height: 20px; width: auto; object-fit: contain;">
            {% endif %}
            
            <span>{{ block.settings.title }}</span>

            {% if block.settings.badge != blank %}
              <span style="position: absolute; top: 5px; right: -5px; color: #e30613; font-size: 10px; font-weight: 900; background: white; padding: 0 2px;">
                {{ block.settings.badge }}
              </span>
            {% endif %}

            {% if block.type == 'mega_menu' %}
              <svg style="width: 8px; height: 8px; margin-left: 2px;" viewBox="0 0 10 6"><path d="M1 1l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            {% endif %}
          </a>

          {% if block.type == 'mega_menu' and block.settings.menu != blank %}
            <div class="jgt-mega-dropdown" style="position: absolute; top: 100%; left: 0; width: 100%; background: white; box-shadow: 0 10px 20px rgba(0,0,0,0.1); display: none; padding: 40px 0; border-top: 1px solid #eee;">
              <div class="jgt-mega-grid" style="max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 30px; padding: 0 20px;">
                {% for link in block.settings.menu.links %}
                  <div class="jgt-mega-column">
                    <a href="{{ link.url }}" style="font-weight: 800; color: #002266; text-decoration: none; margin-bottom: 15px; display: block; border-bottom: 1px solid #eee; padding-bottom: 5px;">{{ link.title }}</a>
                    {% if link.links != blank %}
                      <ul style="list-style: none; padding: 0; margin: 0;">
                        {% for child in link.links %}
                          <li><a href="{{ child.url }}" style="text-decoration: none; color: #555; font-size: 13px; line-height: 2.4; display: block;">{{ child.title }}</a></li>
                        {% endfor %}
                      </ul>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</nav>

<script>
  // Script para manejar el hover en el mega menú
  document.querySelectorAll('.jgt-nav-item').forEach(item => {
    item.addEventListener('mouseenter', () => {
      const dropdown = item.querySelector('.jgt-mega-dropdown');
      if(dropdown) dropdown.style.display = 'block';
    });
    item.addEventListener('mouseleave', () => {
      const dropdown = item.querySelector('.jgt-mega-dropdown');
      if(dropdown) dropdown.style.display = 'none';
    });
  });
</script>

{% schema %}
{
  "name": "Menú Dinámico JGT",
  "settings": [
    { "type": "color", "id": "bg_color", "label": "Color Fondo", "default": "#ffffff" },
    {
      "type": "range",
      "id": "padding_vertical",
      "min": 5,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Grosor del menú (Espaciado vertical)",
      "default": 15
    }
  ],
  "blocks": [
    {
      "type": "simple_link",
      "name": "Enlace Simple",
      "settings": [
        { "type": "text", "id": "title", "label": "Nombre", "default": "Enlace" },
        { "type": "url", "id": "link", "label": "Enlace" },
        { "type": "image_picker", "id": "icon_img", "label": "Icono pequeño" },
        { "type": "checkbox", "id": "highlight", "label": "Resaltar en rojo", "default": false },
        { "type": "text", "id": "badge", "label": "Etiqueta (ej: -10%)" }
      ]
    },
    {
      "type": "mega_menu",
      "name": "Mega Menú",
      "settings": [
        { "type": "text", "id": "title", "label": "Nombre", "default": "Categoría" },
        { "type": "url", "id": "link", "label": "Enlace Principal" },
        { "type": "link_list", "id": "menu", "label": "Seleccionar Menú" },
        { "type": "checkbox", "id": "highlight", "label": "Resaltar en rojo", "default": false },
        { "type": "text", "id": "badge", "label": "Etiqueta" }
      ]
    }
  ],
  "presets": [
    { "name": "Menú Dinámico JGT" }
  ]
}
{% endschema %}